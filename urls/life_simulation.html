<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç”Ÿå‘½æ¸¸æˆ</title>
<link rel="stylesheet" href="../css/index-bar.css" type="text/css">
<style>
    body {
        background: var(--primary-color);
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .container {
        width: 950px;
        height: 521px;
        margin: 0 auto;
        margin-top: 20px;
    }
    .grid-container {
        display: grid;
        grid-template-columns: repeat(50, 10px);
        grid-template-rows: repeat(50, 10px);
        gap: 0px;
        width: 950px;
        background-color: #ddd;
    }
    .cell {
        width: 10px;
        height: 10px;
        background-color: #fff;
    }
    #rules {
        position: relative;
        top: -500px;
        left: 510px;
    }
    #rules p {
        width: 450px;
        line-height: 26px;
        word-wrap: break-word;
    }
</style>
</head>
<body>
<div class="top-nav-bar"></div>
<nav class="top-nav">
    <a href="../index.html" class="nav-logo">ğŸŒŸ æ˜Ÿä¹‹å½¼å²¸</a>
    <div class="nav-links">
        <a href="../index.html" class="nav-link">é¦–é¡µ</a>
        <a href="../main.html" class="nav-link">åƒå–ç©ä¹</a>
    </div>
</nav>
<div id="container" class="container">
    <div id="rounds">ç¬¬1è½®æ¼”åŒ–</div>
    <div class="grid-container" id="gridContainer"></div>
    <div id="rules">
        <h4>åº·å¨ç”Ÿå‘½æ¸¸æˆ Conway's Game of Life</h4>
        <p>è¯¥æ¸¸æˆæ˜¯è‹±å›½æ•°å­¦å®¶çº¦ç¿°Â·ä½•é¡¿Â·åº·å¨ John Horton Conwayåœ¨1970å¹´å‘æ˜çš„ã€‚</p>
        <p>è§„åˆ™å¦‚ä¸‹ï¼š</p>
        <p>1. å¦‚æœä¸€ä¸ªæ ¼å­å‘¨å›´ç™½è‰²æ ¼å­åªæœ‰3ä¸ªï¼Œåˆ™è¯¥æ ¼å­ä¸ºç™½ï¼›</p>
        <p>2. å¦‚æœä¸€ä¸ªæ ¼å­å‘¨å›´ç™½è‰²æ ¼å­åªæœ‰2ä¸ªï¼Œæ ¼å­é¢œè‰²ä¸å˜ï¼›</p>
        <p>3. å¦‚æœä¸€ä¸ªæ ¼å­å‘¨å›´ç™½è‰²æ ¼å­å°‘äº2ä¸ªï¼Œåˆ™è¯¥æ ¼å­ä¸ºé»‘ï¼›</p>
        <p>4. å¦‚æœä¸€ä¸ªæ ¼å­å‘¨å›´ç™½è‰²é¸½å­è¶…è¿‡3ä¸ªï¼Œåˆ™è¯¥æ ¼å­ä¸ºé»‘ã€‚</p>
        <button id="evolveBtn" onclick="window.location.reload()">é‡æ–°æ¼”åŒ–</button>
        <button id="saveBtn">ä¿å­˜ç»“æœ</button>
    </div>
</div>

<script src="../js/html2canvas.min.js"></script>
<script src="../js/stack.js"></script>
<script>
    document.getElementById('saveBtn').addEventListener('click', () => {
        hideBtn('none')
        html2canvas(document.getElementById('container')).then(canvas => {
            // ç”Ÿæˆå½“å‰æ—¶é—´æˆ³
            let timestamp = new Date().toISOString().replace(/[:.]/g, '')
            // å°†canvaså†…å®¹è½¬æ¢ä¸ºå›¾ç‰‡é“¾æ¥
            let link = document.createElement('a')
            link.href = canvas.toDataURL('image/png')
            link.download = `content-${timestamp}.png`
            link.click()
        })
        setTimeout(() => {
            hideBtn('')
        }, 1000)
    })
    const evolveBtn = document.getElementById('evolveBtn')
    const saveBtn = document.getElementById('saveBtn')
    hideBtn('none')
    const stack = new Stack()
    rounds = 0
    timer = null
    // åˆ›å»ºç½‘æ ¼
    const gridContainer = document.getElementById('gridContainer')
    const gridSize = 50
    const grid = createGrid(gridSize)

    // åˆå§‹åŒ–ç½‘æ ¼çŠ¶æ€
    randomizeGrid(grid)

    // æ˜¾ç¤ºç½‘æ ¼
    displayGrid(grid)

    // æ¼”åŒ–å‡½æ•°
    function evolve() {
        const newGrid = createGrid(gridSize);
        for (let i = 0; i < gridSize; i++) {
            for (let j = 0; j < gridSize; j++) {
                const neighbors = countNeighbors(grid, i, j)
                if (neighbors === 3) {
                    newGrid[i][j] = 0
                }
                if (neighbors === 2) {
                    newGrid[i][j] = grid[i][j]
                }
                if (neighbors < 2 || neighbors > 3) {
                    newGrid[i][j] = 1
                }
            }
        }
        copyGrid(newGrid, grid)
        displayGrid(grid)
        if (timer) {
            rounds++
        }
        document.getElementById('rounds').innerHTML = `ç¬¬ ${rounds} è½®æ¼”åŒ–`
        if (stack.size() < 16) {
            stack.push(newGrid)
        } else {
            for (let i = 0; i < stack.size(); i++) {
                let lastGrid = stack.pop()
                if (newGrid.toString() === lastGrid.toString()) {
                    timer = null
                    hideBtn('')
                }
            }
        }
    }

    // åˆ›å»ºç©ºç½‘æ ¼
    function createGrid(size) {
        return Array.from({ length: size }, () => Array.from({ length: size }, () => 0))
    }

    // éšæœºåˆå§‹åŒ–ç½‘æ ¼
    function randomizeGrid(grid) {
        for (let i = 0; i < grid.length; i++) {
            for (let j = 0; j < grid[i].length; j++) {
                grid[i][j] = Math.random() > 0.5 ? 0 : 1
            }
        }
    }

    // ç»Ÿè®¡æŸä¸ªæ ¼å­å‘¨å›´çš„ç™½è‰²æ ¼å­æ•°é‡
    function countNeighbors(grid, x, y) {
        let count = 0;
        for (let i = -1; i <= 1; i++) {
            for (let j = -1; j <= 1; j++) {
                if (i === 0 && j === 0) continue;
                const newX = x + i;
                const newY = y + j;
                if (newX >= 0 && newX < grid.length && newY >= 0 && newY < grid[0].length) {
                    if (grid[newX][newY] === 0) {
                        count++;
                    }
                }
            }
        }
        return count;
    }

    // å¤åˆ¶ç½‘æ ¼çŠ¶æ€
    function copyGrid(source, destination) {
        for (let i = 0; i < source.length; i++) {
            for (let j = 0; j < source[i].length; j++) {
                destination[i][j] = source[i][j];
            }
        }
    }

    // æ˜¾ç¤ºç½‘æ ¼
    function displayGrid(grid) {
        gridContainer.innerHTML = '';
        grid.forEach(row => {
            row.forEach(cell => {
                const cellElement = document.createElement('div');
                cellElement.className = 'cell';
                if (cell === 1) {
                    cellElement.style.backgroundColor = '#000';
                }
                gridContainer.appendChild(cellElement);
            });
        });
    }

    function hideBtn(show='none') {
        evolveBtn.style.display = show
        saveBtn.style.display = show
    }

    // è‡ªåŠ¨æ¼”åŒ–
    timer = setInterval(evolve, 100);
</script>

</body>
</html>
