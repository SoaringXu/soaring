<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ»‘åŠ¨æ¡æŒ‘æˆ˜</title>
    <link rel="stylesheet" href="../css/index-bar.css" type="text/css">
    <link rel="stylesheet" href="../css/index.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #6ee7b7, #3b82f6);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        #targetValue {
            font-size: 1.3rem;
            color: #ef4444;
            font-weight: bold;
        }
        #slider-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
            width: 90%;
            max-width: 600px;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #slider {
            width: 100%;
            height: 20px;
            background: linear-gradient(to right, rgba(59, 130, 246, 0.4), rgba(34, 197, 94, 0.4)); /* æ›´é€æ˜çš„æ»‘è½¨æ¸è¿›è‰² */
            border-radius: 10px;
            position: relative;
            margin: 1rem 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15), inset 0 -1px 2px rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(5px);
        }
        /* æ·»åŠ ç›®æ ‡æ ‡è®°æ ·å¼ */
        #target-marker {
            position: absolute;
            top: -10px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid #ef4444; /* çº¢è‰²å€’ä¸‰è§’ */
            transform: translateX(-50%); /* å±…ä¸­å¯¹é½ */
            z-index: 1;
        }
        #slider-bar {
            width: 23px;
            height: 23px; /* ç¡®ä¿æ˜¯åœ†å½¢ */
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.9), rgba(195, 192, 255, 0.4), rgba(59, 130, 246, 0.3)); /* ç»ç’ƒçƒæ¸å˜æ•ˆæœ */
            position: absolute;
            top: -3px;
            border-radius: 50%; /* å®Œå…¨åœ†å½¢ */
            transition: transform 0.05s linear;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.7), 0 2px 5px rgba(0, 0, 0, 0.8);
            transform-origin: center;
            border: 1px solid rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            overflow: hidden;
            z-index: 2;
        }
        #slider-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0));
            border-radius: 50% 50% 0 0;
        }
        #slider-bar::before {
            content: '';
            position: absolute;
            bottom: 10%;
            right: 10%;
            width: 30%;
            height: 30%;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            filter: blur(1px);
        }
        #bonus {
            margin-top: 0.5rem;
            font-size: 1.2rem;
            font-weight: bold;
        }
        /* æ·»åŠ æŒ‘æˆ˜å€’è®¡æ—¶æ ·å¼ */
        #challenge-timer {
            font-size: 1.2rem;
            color: green;
            font-weight: bold;
            margin-top: 0.5rem;
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            from { opacity: 0.7; }
            to { opacity: 1; }
        }
        #stop-button {
            background: #ef4444;
            color: white;
            width: 120px; /* å›ºå®šå®½åº¦ */
            height: 48px; /* å›ºå®šé«˜åº¦ */
            border-radius: 0.5rem;
            font-weight: bold;
            font-size: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 1rem;
            transition: transform 0.2s, background 0.3s, opacity 0.3s;
        }
        #stop-button:hover:not(:disabled) {
            background: #dc2626;
            transform: scale(1.0);
        }
        #stop-button:active:not(:disabled) {
            transform: scale(0.95);
        }
        #stop-button:disabled {
            background: #f87171;
            cursor: not-allowed;
            opacity: 0.6;
        }
        #result {
            font-size: 1.2rem;
            color: #1f2937;
            font-weight: bold;
            opacity: 1; /* å§‹ç»ˆå¯è§ */
            display: block;
            text-align: center;
            margin-bottom: 0.8rem; /* è°ƒæ•´ä¸æ»‘å—çš„é—´è· */
            min-width: 120px; /* å›ºå®šæœ€å°å®½åº¦ */
        }
        @media (max-width: 640px) {
            #slider-container {
                padding: 1.2rem;
            }
            #result {
                font-size: 1.2rem;
                min-width: 100px;
            }
            #stop-button {
                width: 100px;
                height: 40px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="top-nav-bar"></div>
    <nav class="top-nav">
        <a href="../index.html" class="nav-logo">ğŸŒŸ æ˜Ÿä¹‹å½¼å²¸</a>
        <div class="nav-links">
            <a href="../index.html" class="nav-link">é¦–é¡µ</a>
            <a href="../main.html" class="nav-link">åƒå–ç©ä¹</a>
        </div>
    </nav>
    <div id="slider-container">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">æ»‘åŠ¨æ¡æŒ‘æˆ˜</h1>
        <h3 id="targetValue" class="text-xl font-bold mb-1"></h3>
        <p class="text-gray-600 mb-2">ç‚¹å‡»ã€åœæ­¢ã€‘ï¼Œæ»‘å—å°†åœåœ¨éšæœºä½ç½®ï¼Œè¶Šæ¥è¿‘ç›®æ ‡å€¼å¾—åˆ†è¶Šé«˜ï¼</p>
        <div id="result"></div>
        <div id="slider">
            <div id="target-marker"></div>
            <div id="slider-bar"></div>
        </div>
        <div id="challenge-timer"></div>
        <div id="bonus"></div>
        <button id="stop-button">åœæ­¢</button>
    </div>

    <script>
        const slider = document.getElementById('slider');
        const sliderBar = document.getElementById('slider-bar');
        const stopButton = document.getElementById('stop-button');
        const result = document.getElementById('result');
        const bonusDiv = document.getElementById('bonus');
        
        // åˆå§‹è®¡ç®—æœ€å¤§ä½ç½®
        let maxPosition = slider.offsetWidth - sliderBar.offsetWidth;
        
        // åˆå§‹åŒ–æ»‘å—ä½ç½®ï¼Œç¡®ä¿ä»æœ€å·¦ä¾§å¼€å§‹
        sliderBar.style.left = '0px';
        
        const SPEED = 5;
        const CD = 3;

        // æ·»åŠ æŒ‘æˆ˜å€’è®¡æ—¶å˜é‡
        const CHALLENGE_TIME = 10; // 10ç§’æŒ‘æˆ˜æ—¶é—´
        let challengeTimer = 0;
        let challengeTimerInterval = null;
        const challengeTimerElement = document.getElementById('challenge-timer');
        
        let position = 0;
        let speed = SPEED;
        let isMoving = true;
        let direction = 1;
        let targetValue = Math.round(Math.random() * 100); // éšæœºç›®æ ‡å€¼ï¼ˆ0-100%ï¼‰
        let timeout = false;

        // æ·»åŠ çª—å£å¤§å°å˜åŒ–ç›‘å¬å™¨ï¼Œæ›´æ–°maxPosition
        window.addEventListener('resize', function() {
            // é‡æ–°è®¡ç®—æœ€å¤§ä½ç½®
            maxPosition = slider.offsetWidth - sliderBar.offsetWidth;
            
            // å¦‚æœå½“å‰ä½ç½®è¶…å‡ºæ–°çš„æœ€å¤§ä½ç½®ï¼Œè°ƒæ•´ä½ç½®
            if (position > maxPosition) {
                position = maxPosition;
                sliderBar.style.left = `${position}px`;
            }
        });

        // åˆå§‹éšè—åœæ­¢æŒ‰é’®
        stopButton.style.display = 'none';
        // åœ¨ç»“æœåŒºåŸŸæ˜¾ç¤ºå€’è®¡æ—¶
        result.textContent = `å‡†å¤‡å¼€å§‹ï¼š${CD}`;
        
        // å€’è®¡æ—¶å‡½æ•°
        let countdown = CD;
        const countdownTimer = setInterval(() => {
            countdown--;
            if (countdown > 0) {
                result.textContent = `å‡†å¤‡å¼€å§‹ï¼š${countdown}`;
            } else {
                clearInterval(countdownTimer);
                result.textContent = `æ»‘å—ä½ç½®ï¼š00.00%`;
                stopButton.style.display = 'flex'; // æ˜¾ç¤ºåœæ­¢æŒ‰é’®

                startChallengeTimer();  // å¯åŠ¨æŒ‘æˆ˜å€’è®¡æ—¶
            }
        }, 1000);

        function startChallengeTimer() {
            // åˆå§‹åŒ–æŒ‘æˆ˜å€’è®¡æ—¶
            challengeTimer = CHALLENGE_TIME;
            challengeTimerElement.textContent = `æŒ‘æˆ˜å€’è®¡æ—¶ï¼š${challengeTimer}ç§’`;
            challengeTimerElement.style.display = 'block';
            
            // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
            if (challengeTimerInterval) {
                clearInterval(challengeTimerInterval);
            }
            
            // å¯åŠ¨æ–°çš„è®¡æ—¶å™¨
            challengeTimerInterval = setInterval(() => {
                challengeTimer--;
                challengeTimerElement.textContent = `æŒ‘æˆ˜å€’è®¡æ—¶ï¼š${challengeTimer}ç§’`;
                
                // å½“å€’è®¡æ—¶ç»“æŸæ—¶
                if (challengeTimer <= 0) {
                    clearInterval(challengeTimerInterval);
                    
                    // å¦‚æœç”¨æˆ·è¿˜æ²¡æœ‰ç‚¹å‡»åœæ­¢æŒ‰é’®
                    if (isMoving) {
                        isMoving = false;
                        stopButton.disabled = true;
                        // æ·»åŠ è¶…æ—¶æç¤º
                        timeout = true;
                    }
                }
                
                // å½“å€’è®¡æ—¶å°äºç­‰äº3ç§’æ—¶ï¼Œæ”¹å˜é¢œè‰²å¹¶åŠ å¿«é—ªçƒ
                if (challengeTimer <= 3) {
                    challengeTimerElement.style.color = '#dc2626';
                    challengeTimerElement.style.animation = 'pulse 0.5s infinite alternate';
                }
            }, 1000);
        }

        function showTargetValue() {
            const targetValueElement = document.getElementById('targetValue');
            targetValueElement.textContent = `ç›®æ ‡å€¼ï¼š${targetValue}%`;
            
            // æ›´æ–°ç›®æ ‡æ ‡è®°ä½ç½®
            const targetMarker = document.getElementById('target-marker');
            const targetPosition = (targetValue / 100) * slider.offsetWidth;
            targetMarker.style.left = `${targetPosition}px`;
        }
        showTargetValue();

        function formatPosition(value, stop) {
            if (Math.abs(value - 100) < 0.01) {
                if (stop) {
                    return '100%'; // ç²¾ç¡®åˆ°100%æ—¶æ˜¾ç¤ºæ— å°æ•°
                }
                return '99.99%'; // ç²¾ç¡®åˆ°100%æ—¶æ˜¾ç¤ºæ— å°æ•°
            }
            const fixedValue = value.toFixed(2); // ä¿ç•™2ä½å°æ•°
            let integerPart = Math.floor(value).toString()
            if (!stop) {
                integerPart = integerPart.padStart(2, '0'); // æ•´æ•°éƒ¨åˆ†è¡¥0åˆ°2ä½
            }
            const decimalPart = fixedValue.split('.')[1]; // å°æ•°éƒ¨åˆ†
            return `${integerPart}.${decimalPart}%`; // æ ¼å¼ä¸ºXX.XX%
        }

        function getBounusValue(currentValue, targetValue) {
            let deltaValue = Math.abs(currentValue - targetValue);
            return Math.floor(Math.max(0, 100 * (1 - deltaValue / 50)));
        }

        function showBonus(bonus) {
            let color = 'black';
            if (bonus > 80) {
                color = 'green';
            } else if (bonus > 60) {
                color = 'darkorange';
            } else {
                color = 'red';
            }
            let html = `<p>æŒ‘æˆ˜å¾—åˆ†: <span style="color: ${color}">${bonus}åˆ†</span></p>`
            if (timeout) {
                html = `<p>æŒ‘æˆ˜å¾—åˆ†: <span style="color: red">0åˆ†</span>ï¼ˆè¶…æ—¶ï¼‰</p>`;
            }
            bonusDiv.innerHTML = html;
            bonusDiv.style.display = 'block'; // æ˜¾ç¤ºæŒ‘æˆ˜å¾—åˆ†
        }

        function animateSlider() {
            // ç¡®ä¿æ¯å¸§éƒ½é‡æ–°è®¡ç®—æœ€å¤§ä½ç½®ï¼Œä»¥é€‚åº”å¯èƒ½çš„çª—å£å¤§å°å˜åŒ–
            maxPosition = slider.offsetWidth - sliderBar.offsetWidth;
            
            const targetPosition = (targetValue / 100) * maxPosition;

            // å®æ—¶æ›´æ–°æ»‘å—ä½ç½®æ˜¾ç¤º
            const currentValue = (position / maxPosition) * 100;
            // åªæœ‰å€’è®¡æ—¶ç»“æŸåæ‰æ›´æ–°ä½ç½®æ˜¾ç¤º
            if (countdown <= 0) {
                showTargetValue();
                result.textContent = `æ»‘å—ä½ç½®ï¼š${formatPosition(currentValue)}`;
            }

            if (!isMoving) {
                if (stopTimer > 0) {
                    // åŒ€é€Ÿå‡æ…¢ç›´åˆ°åœæ­¢
                    const decelerationRate = initialSpeed / (STOP_DURATION / 16); // æ¯å¸§å‡å°‘çš„é€Ÿåº¦
                    currentSpeed -= decelerationRate;
                    
                    // ç¡®ä¿é€Ÿåº¦ä¸ä¼šå˜ä¸ºè´Ÿæ•°
                    if (currentSpeed < 0) currentSpeed = 0;
                    
                    // æŒ‰å½“å‰é€Ÿåº¦å’Œæ–¹å‘ç§»åŠ¨
                    position += currentSpeed * direction;
                    
                    // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾è¾¹ç•Œ
                    if (position >= maxPosition) {
                        position = maxPosition;
                        direction = -1;
                    } else if (position <= 0) {
                        position = 0;
                        direction = 1;
                    }
                    // æ›´æ–°åœæ­¢è®¡æ—¶å™¨
                    stopTimer -= 16;
                    let bonus = getBounusValue(currentValue, targetValue);
                    showBonus(bonus);
                } else {
                    // å®Œå…¨åœæ­¢
                    const currentValue = (position / maxPosition) * 100;
                    //targetValue = currentValue;
                    let bonus = getBounusValue(currentValue, targetValue);
                    showBonus(bonus);

                    // æ˜¾ç¤ºæœ€ç»ˆä½ç½®
                    result.textContent = `æ»‘å—ä½ç½®ï¼š${formatPosition(currentValue, true)}`;
                    stopButton.textContent = 'å†æ¥ä¸€æ¬¡';
                    stopButton.disabled = false; // é‡æ–°å¯ç”¨æŒ‰é’®
                    // é‡ç½®æŒ‘æˆ˜å€’è®¡æ—¶å…ƒç´ 
                    challengeTimerElement.style.display = 'none';
                    challengeTimerElement.style.color = 'green';
                    challengeTimerElement.style.animation = 'pulse 1s infinite alternate';
                    return;
                }
            } else {
                // æ­£å¸¸ç§»åŠ¨
                position += speed * direction;

                if (position >= maxPosition) {
                    position = maxPosition;
                    direction = -1;
                } else if (position <= 0) {
                    position = 0;
                    direction = 1;
                }
            }
    
            // ç¡®ä¿ä½ç½®ä¸ä¼šè¶…å‡ºè¾¹ç•Œ
            if (position > maxPosition) {
                position = maxPosition;
            } else if (position < 0) {
                position = 0;
            }
    
            // æ›´æ–°æ»‘å—ä½ç½®
            sliderBar.style.left = `${position}px`;
            
            requestAnimationFrame(animateSlider);
        }

        // æ·»åŠ åœæ­¢è®¡æ—¶å™¨å˜é‡
        let stopTimer = 0;
        let STOP_DURATION = 1000; // é»˜è®¤1ç§’åœæ­¢æ—¶é—´ï¼Œå°†è¢«éšæœºå€¼æ›¿æ¢
        let initialPosition = 0; // è®°å½•ç‚¹å‡»åœæ­¢æ—¶çš„åˆå§‹ä½ç½®
        let initialSpeed = 0; // è®°å½•ç‚¹å‡»åœæ­¢æ—¶çš„åˆå§‹é€Ÿåº¦
        let currentSpeed = 0; // å½“å‰é€Ÿåº¦

        // åœæ­¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        stopButton.addEventListener('click', () => {
            if (isMoving) {
                stopButton.disabled = true; // ç¦ç”¨æŒ‰é’®ç›´åˆ°åœæ­¢å®Œæˆ
                isMoving = false;

                // æ¸…é™¤æŒ‘æˆ˜å€’è®¡æ—¶
                if (challengeTimerInterval) {
                    clearInterval(challengeTimerInterval);
                    challengeTimerElement.style.display = 'none';
                }

                // ç”Ÿæˆ1-10ç§’ä¹‹é—´çš„éšæœºåœæ­¢æ—¶é—´
                STOP_DURATION = Math.floor(Math.random() * 4000 + 1000); // 1000-5000æ¯«ç§’
                
                // è®°å½•ç‚¹å‡»åœæ­¢æ—¶çš„åˆå§‹ä½ç½®å’Œé€Ÿåº¦
                initialPosition = position;
                initialSpeed = speed;
                currentSpeed = speed;
                
                // è®¾ç½®åœæ­¢è®¡æ—¶å™¨
                stopTimer = STOP_DURATION;
            } else {
                // é‡æ–°å¼€å§‹æ—¶ï¼Œå…ˆéšè—æŒ‰é’®å¹¶å¼€å§‹å€’è®¡æ—¶
                stopButton.style.display = 'none';
                bonusDiv.style.display = 'none'; // éšè—æŒ‘æˆ˜å¾—åˆ†
                position = 0;
                speed = SPEED;
                isMoving = true;
                direction = 1;
                targetValue = Math.round(Math.random() * 100); // éšæœºç›®æ ‡å€¼ï¼ˆ0-100%ï¼‰
                stopTimer = 0; // é‡ç½®åœæ­¢è®¡æ—¶å™¨
                timeout = false;  // é‡ç½®è¶…æ—¶çŠ¶æ€
                
                animateSlider();
                // é‡æ–°å¼€å§‹å€’è®¡æ—¶
                countdown = CD;
                result.textContent = `å‡†å¤‡å¼€å§‹ï¼š${countdown}`;
                
                const newCountdownTimer = setInterval(() => {
                    countdown--;
                    if (countdown > 0) {
                        result.textContent = `å‡†å¤‡å¼€å§‹ï¼š${countdown}`;
                    } else {
                        clearInterval(newCountdownTimer);
                        result.textContent = `æ»‘å—ä½ç½®ï¼š00.00%`;
                        stopButton.style.display = 'flex'; // æ˜¾ç¤ºåœæ­¢æŒ‰é’®
                        stopButton.textContent = 'åœæ­¢';
                        stopButton.disabled = false; // ç¡®ä¿æŒ‰é’®å¯ç”¨

                        startChallengeTimer();  // å¯åŠ¨æ–°çš„æŒ‘æˆ˜å€’è®¡æ—¶
                    }
                }, 1000);
            }
        });

        animateSlider();
    </script>
</body>
</html>